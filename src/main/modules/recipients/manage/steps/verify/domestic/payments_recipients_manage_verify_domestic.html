<div ng-controller="RecipientsManageVerifyDomesticController">

    <eb-preloader class="eb-list-preloader" eb-promise="recipient.promises.authorizationPromise"></eb-preloader>
    <bd-item-property ng-if="customerDetails.context == 'MICRO'" class="bd-item-property--text bd-item-property--disabled" label="{{ ::'raiff.payments.recipients.edit.domestic.verify.company.name' | translate }}">
        <section ng-show="recipient.items.senderAccount.accountName && recipient.items.senderAccount.accountNo">
            <div ng-repeat="owner in ownerList = (getAccountByNrb(recipient.items.senderAccount.accountNo).ownersList | filter: { relationType: 'OWNER' }:true)">
                <span>{{owner.fullName}}</span>
            </div>
        </section>
        <section ng-hide="recipient.items.senderAccount.accountName && recipient.items.senderAccount.accountNo">
            <div ng-repeat="owner in ownerList = (getAccountByNrb(recipient.formData.debitAccountNo).ownersList | filter: { relationType: 'OWNER' }:true)">
                <span>{{owner.fullName}}</span>
            </div>
        </section>
    </bd-item-property>
    <bd-item-property ng-if="(recipient.operationType == 'remove' || recipient.operationType == 'edit')" class="bd-item-property--text bd-item-property--disabled" label="{{::'raiff.payments.recipients.edit.domestic.verify.recipient.id'|translate}}">
        {{ recipient.id}}
    </bd-item-property>
    <bd-item-property class="bd-item-property--text bd-item-property--disabled" label="{{ ::'raiff.payments.recipients.new.domestic.fill.account_related' | translate }}">
        <section ng-show="recipient.items.senderAccount.accountName && recipient.items.senderAccount.accountNo">
            {{ recipient.items.senderAccount.accountName }}&nbsp;

            {{ recipient.items.senderAccount.accountNo }}
        </section>
        <section ng-hide="recipient.items.senderAccount.accountName && recipient.items.senderAccount.accountNo">
            {{ recipient.formData.debitAccountNo | nrbIbanFilter }}
        </section>
    </bd-item-property>

    <bd-item-property class="bd-item-property--text bd-item-property--disabled" label="{{ ::'raiff.payments.recipients.new.domestic.fill.custom_name.label' | translate }}">
        {{ recipient.formData.customName }}
    </bd-item-property>

    <bd-item-property class="bd-item-property--text bd-item-property--disabled" label="{{ ::'raiff.payments.recipients.new.domestic.fill.recipient_account.label' | translate }}">
        {{ recipient.formData.recipientAccountNo | nrbIbanFilter }}
    </bd-item-property>

    <bd-item-property class="bd-item-property--multirow bd-item-property--text bd-item-property--disabled"
                      label="{{ ::'raiff.payments.recipients.new.domestic.fill.recipient_data.label' | translate }}">
        <p style="white-space: pre;" ng-bind-html="formatTextBox(recipient.formData.recipientData)"></p>
    </bd-item-property>

    <bd-item-property class="bd-item-property--multirow bd-item-property--text bd-item-property--disabled"
                      label="{{ ::'raiff.payments.recipients.new.domestic.fill.description.label' | translate }}">
        <p style="white-space: pre;" ng-bind-html="formatTextBox(recipient.formData.description)"></p>
    </bd-item-property>


    <span ng-if="recipient.promises.authorizationPromise.$$state.status === 1">
    <form name="recipientAuthForm" novalidate ng-if="recipient.options.twoStepAuthorization">
        <div ng-init="setForm(recipientAuthForm);"></div>

        <div ng-switch="payment.result.token_error">

        <div ng-switch-when="true" class="rb-payments-token-error">

            <div ng-messages="payment.result.token_errors"  class="messages">
                <div ng-message="authorization_blocked" class="validation-message animate-on">
                    {{::'raiff.payments.MSG-0518_BLOCKED_SMS'|translate}}
                </div>
                <div ng-message="incorrect_password" class="validation-message animate-on">
                    {{::'raiff.payments.MSG-0514_INCORRECT_SMS'|translate}}
                </div>
                <div ng-message="expired" class="validation-message animate-on">
                    {{::'raiff.payments.MSG-0515_EXPIRED_SMS'|translate}}
                </div>
                <div ng-message="incorrect_password_authorization_blocked" class="validation-message animate-on">
                    {{::'raiff.payments.MSG-0517_INCORRECT_BLOCKED_SMS'|translate}}
                </div>
                <div ng-message="system_failure" class="validation-message animate-on">
                    {{::'raiff.payments.MSG-0519_SMS_AGAIN'|translate}}
                </div>
            </div>

            <bd-radio-select bd-model="payment.result.nextTokenType">
                <bd-radio-option bd-option-value="'prev'">{{::'raiff.payments.new.verify.token.authorize.prev'|translate}}</bd-radio-option>
                <bd-radio-option bd-option-value="'next'">{{::'raiff.payments.new.verify.token.authorize.next'|translate}}</bd-radio-option>
            </bd-radio-select>

        </div>

        <div >
            <bd-item-property label="{{ recipient.items.smsText }}">

                <input type="text"
                       name="authCode"
                       bd-novalidate-when="payment.result.token_error"
                       ng-model="recipient.items.credentials"
                       required/>

                <eb-validation-messages eb-name="authCode">
                    <div eb-message-key="required" class="validation-message animate-on">
                        {{::'raiff.payments.new.domestic.fill.execution_date.EMPTY_AUTH'|translate}}
                    </div>
                </eb-validation-messages>

            </bd-item-property>
        </div>

    </div>

    </form>
    </span>

    <form name="paymentResponseForm">

        <input ng-model="paymentResponseModel" type="hidden" name="payment" />
        <eb-validation-messages eb-name="payment">
            <div eb-message-key="payment.token.authorization_blocked" class="validation-message animate-on">
                {{::'raiff.payments.recipients.authorization.BLOCKED_SMS'|translate}}
            </div>
        </eb-validation-messages>

    </form>


</div>